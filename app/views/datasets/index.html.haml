- @title = 'Datasets'

- content_for :body_class do
  brand-background

- content_for :header do
  .header-container
    .container
      %h1.page-heading
        .pull-right
          = link_to plus_or('Create Dataset'), new_dataset_path, class: 'btn btn-accent btn-shadow' if current_user && current_user.system_admin?
          = render 'layouts/per_page', per_page: 24, object_count: @datasets.total_count
        = @title

%div{ style: 'margin-bottom: 20px;display: flex;' }
  %div{ style: 'margin: auto; flex: 1; text-align: center' }
    %div.center{ style: 'font-size: 10px;' } AGES
    .btn-group
      = link_to '#', class: 'btn btn-default dropdown-toggle', data: { toggle: 'dropdown' }, aria: { haspopup: 'true', expanded: 'false' } do
        %span.hidden-sm.hidden-md.hidden-lg.glyphicon.glyphicon-cog
        %span.hidden-xs All Ages
        %span.caret
      %ul.dropdown-menu
        %li= link_to 'All Ages', datasets_path(children: '1')
        %li= link_to 'Children', datasets_path(children: '1')
        %li= link_to 'Adults', datasets_path(adults: '1')
  %div{ style: 'margin: auto; flex: 1; text-align: center' }
    %div.center{ style: 'font-size: 10px;' } DATA
    .btn-group
      = link_to '#', class: 'btn btn-default dropdown-toggle', data: { toggle: 'dropdown' }, aria: { haspopup: 'true', expanded: 'false' } do
        %span.hidden-sm.hidden-md.hidden-lg.glyphicon.glyphicon-cog
        %span.hidden-xs All Data Types
        %span.caret
      %ul.dropdown-menu
        %li= link_to 'All Data Types', datasets_path(children: '1')
        %li= link_to 'Phenotype', datasets_path(children: '1')
        %li= link_to 'Actigraphy', datasets_path(adults: '1')
        %li= link_to 'Polysomnography', datasets_path(adults: '1')
  %div{ style: 'margin: auto; flex: 1; text-align: center' }
    %div.center{ style: 'font-size: 10px;' } SORT
    .btn-group
      = link_to '#', class: 'btn btn-default dropdown-toggle', data: { toggle: 'dropdown' }, aria: { haspopup: 'true', expanded: 'false' } do
        %span.hidden-sm.hidden-md.hidden-lg.glyphicon.glyphicon-cog
        %span.hidden-xs Publish Date
        %span.caret
      %ul.dropdown-menu.dropdown-menu-right
        %li= link_to 'Publish Date', datasets_path(adults: '1')
        %li= link_to 'Newest', datasets_path(children: '1')
        %li= link_to 'Popular', datasets_path(adults: '1')
        %li= link_to 'Highest Rated', datasets_path(adults: '1')

- @datasets.each do |dataset|
  .dataset-card{ id: "dataset-card-#{dataset.id}" }
    .dataset-card-header
      = render 'datasets/card_icon', dataset: dataset
      .dataset-card-header-ratings
        .pull-right
          %span{ style: 'color: #ccc;' }
            %span.hidden-xs Reviews
            = surround '(', ')' do
              = link_to number_with_delimiter(dataset.dataset_reviews.count), dataset_dataset_reviews_path(dataset)
          = render 'datasets/rating', rating: dataset.rating
        = link_to dataset.name, dataset

    .dataset-card-body
      .not-flipped
        .dataset-card-logo
          - if dataset.logo.size > 0
            = link_to image_tag(logo_dataset_path(dataset)), dataset
        = render 'datasets/card_content', dataset: dataset
      .already-flipped
        = simple_markdown(dataset.description)
    %div{ style: 'background-color: #ededed;padding: 10px;' }
      - if dataset.description.present?
        .pull-left
          = link_to '#', data: { object: 'flip-card', target: "#dataset-card-#{dataset.id}" } do
            Details
            %span.glyphicon.glyphicon-menu-down
      .dataset-card-footer-links
        %span.hidden-xs{ style: 'color: #ccc;' } View
        .dataset-card-footer-entry
          = link_to dataset, class: 'no-underline' do
            Docs
        .dataset-card-footer-spacer|
        .dataset-card-footer-entry
          = link_to files_dataset_path(dataset), class: 'no-underline' do
            Files
        .dataset-card-footer-spacer|
        .dataset-card-footer-entry
          = link_to dataset_variables_path(dataset), class: 'no-underline' do
            Variables

.center= paginate @datasets, theme: 'bootstrap'

- content_for :call_to_action do
  .call-to-action
    .call-to-action-header
      Would you like to contribute a dataset?
    .call-to-action-body
      We can help you host your dataset on the NSRR, start by
      = link_to 'filling out a short form', dataset_hosting_start_path
      to learn more about the process.
