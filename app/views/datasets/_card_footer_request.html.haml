- arrow = false
- approved = false
- under_review = false
-# TODO: Make sure users with approved access, where the dataset may no longer
-# have a final legal document for user are still viewable.
- if dataset.final_legal_document_for_user(current_user)
  - data_requests = dataset.data_requests.where(user: current_user).where.not(final_legal_document_id: nil)
  - if data_request = data_requests.not_expired.find_by(status: "approved")
    - title = "Data Access Approved"
    - url = files_dataset_path(dataset)
    - approved = true
  - elsif data_request = data_requests.find_by(status: "submitted")
    - title = "Data Request Under Review"
    - url = data_requests_path
    - under_review = true
  - elsif data_request = data_requests.find_by(status: "resubmit")
    - title = "Resubmit Data Request"
    -# TODO: Change resubmit data request path
    - url = data_requests_proof_path(data_request)
    - arrow = true
  - elsif data_request = data_requests.expired.first
    -# TODO: Fix "Renew DAUA" path
    - title = "Data Request Expired"
    - url = data_requests_start_path(dataset)
    - arrow = true
  - elsif data_request = data_requests.find_by(status: "started")
    - title = "Resume Data Request"
    - if data_request.complete?
      - url = data_requests_proof_path(data_request)
    - else
      - url = data_requests_page_path(data_request, data_request.current_step.positive? ? data_request.current_step : 1)
    - arrow = true
  - else
    - title = "Request Data Access"
    - url = data_requests_start_path(dataset)
    - arrow = true
- elsif dataset.release_date && dataset.release_date > Time.zone.today
  - title = "Coming #{dataset.release_date.strftime("%b %e, %Y")}"
  - url = dataset
- else
  - title = "Preview"
  - url = dataset

- if approved
  %i.fa.fa-check-circle.text-success.d-inline-block.d-sm-none
- if under_review
  %i.fa.fa-comments-o.text-muted.d-inline-block.d-sm-none
= link_to url do
  = title
  - if arrow
    %i.fa.fa-caret-right
- if approved
  %i.fa.fa-check-circle.text-success.d-none.d-sm-inline-block
- if under_review
  %i.fa.fa-comments-o.text-muted.d-none.d-sm-inline-block

-# TODO: Remove
- if false
  - if dataset.organization && !dataset.legal_documents.published.count.zero?
    = link_to agreement_start_path(dataset_id: dataset) do
      START
      %i.fa.fa-caret-right
