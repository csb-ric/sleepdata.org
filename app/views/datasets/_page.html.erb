<% page_path = @dataset.find_page(path) %>
<% path = (page_path ? page_path.gsub(@dataset.pages_folder + '/', '') : nil) %>

<ol class="breadcrumb">
  <li><%= link_to @dataset.slug, pages_dataset_path(@dataset) %></li>
  <li class="<%= 'active' unless path.blank? %>"><%= link_to_if !path.blank?, 'pages', pages_dataset_path(@dataset) %></li>
  <% unless path.blank? %>
    <% path.to_s.split('/')[0..-2].each_with_index do |folder, index| %>
      <% url = pages_dataset_path( @dataset ) + '/' + path.to_s.split('/')[0..index].join('/') %>
      <li><%= link_to folder, url %></li>
    <% end %>
    <li class="active"><%= path.to_s.split('/').last %></li>
  <% end %>
</ol>

<% if page_path and File.file?(page_path) and File.size(page_path) < 1.megabyte %>
  <%= render partial: 'datasets/render_page', locals: { page_path: page_path, path: path } %>
<% elsif page_path and File.directory?(page_path) %>
  <div class="file-list-container">
    <table class="table table-condensed table-hover" style="margin-bottom:0px"><col width="1px" />
      <% @dataset.pages(path).each do |page_name, page| %>
        <% is_file = File.file?(page) %>
        <% folder = @dataset.page_path(page) %>
        <% url = pages_dataset_path( @dataset ) + '/' + folder %>
        <tr>
          <td><span class="glyphicon glyphicon-<%= is_file ? 'file' : 'folder-close' %>"></span></td><td><%= link_to page_name, url %></td>
        </tr>
      <% end %>
    </table>
  </div>

  <% if File.exists?(File.join(page_path, 'README.md')) %>
    <%= render partial: 'datasets/render_page', locals: { page_path: File.join(page_path, 'README.md'), path: 'README.md' } %>
  <% elsif @dataset.pages(path).select{|name, f| File.file?(f)}.size > 0 %>
    <% first_page = @dataset.pages(path).select{|name, f| File.file?(f)}.first %>
    <%= render partial: 'datasets/render_page', locals: { page_path: first_page[1], path: first_page[0] } %>
  <% end %>
<% else %>
  <%= render partial: 'datasets/nodoc' %>
<% end %>
