- title = ''
- icon = 'glyphicon-question-sign'
- icon_class = 'card-icon-primary'
- url = submissions_path

- if dataset.release_date && dataset.release_date <= Date.today
  - agreements = (current_user ? dataset.agreements.where(user_id: current_user.id) : Agreement.none)
  - if agreement = agreements.find_by(status: 'approved')
    - title = 'Data Access Approved'
    - icon = 'glyphicon-ok'
    - url = files_dataset_path(dataset)
  - elsif agreement = agreements.find_by(status: 'submitted')
    - title = 'Submitted for Review'
    - icon = 'glyphicon-user'
    - icon_class = 'card-icon-default'
    - url = submissions_path

  - elsif agreement = agreements.find_by(status: 'resubmit')
    - title = 'Changes Required<br>Resubmit Your DAUA'
    - icon = 'glyphicon-exclamation-sign'
    - icon_class = 'card-icon-accent'
    - url = submissions_path
  - elsif agreement = agreements.expired.first
    - title = 'Request Expired<br>Renew Access'
    - icon = 'glyphicon-share-alt'
    - icon_class = 'card-icon-accent'
    - url = submissions_start_path(dataset: dataset)
  - elsif agreement = agreements.find_by(status: 'started')
    - title = 'Request Started<br>Complete Your DAUA'
    - icon = 'glyphicon-cloud-download'
    - icon_class = 'card-icon-accent'
    - if agreement.fully_filled_out?
      - url = proof_agreement_path(agreement)
    - else
      - url = step_agreement_path(agreement, step: agreement.current_step)
  - else
    - title = 'Request Access'
    - icon = 'glyphicon-cloud-download'
    - icon_class = 'card-icon-accent'
    - url = submissions_start_path(dataset: dataset)
- elsif dataset.release_date
  - title = "Coming Soon<br>#{dataset.release_date.strftime('%B %e, %Y')}"
  - icon = 'glyphicon-gift'
  - icon_class = 'card-icon-default'
  - url = dataset
- else
  - title = 'Preview'
  - icon = 'glyphicon-gift'
  - icon_class = 'card-icon-default'
  - url = dataset

.dataset-card-header-icon{ class: icon_class }
  = link_to url do
    %span.glyphicon{ class: [icon], style: '', rel: 'tooltip', data: { container: 'body', placement: 'bottom', title: title, html: 'true' } }
