<% if @dataset %>
  <% @title = @dataset.name %>
  <%= render partial: 'datasets/header' %>
<% end %>

<div class="page-header">
  <ul class="pagination pagination-sm pull-right">
    <% ('a'..'z').each do |letter| %>
      <li class="<%= 'active' if letter == @search %>"><%= link_to letter, collection_path( s: letter, d: params[:d] ) %></li>
    <% end %>
  </ul>
  <h1>
  <% unless @dataset %>
    Collection
  <% end %>

  <form action="<%= collection_path %>" method="get" id="collection_form" class="form-inline" >
    <%= hidden_field_tag 'd', params[:d] %>
    <%= text_field_tag 's', params[:s], class: 'form-control' %>
    <%= link_to 'Search', '#', class: 'btn btn-primary', data: { object: 'submit', target: '#collection_form' } %>
  </form>
  </h1>
</div>

<% if false %>
  <div class="pull-right">
    <ul class="pagination pagination-sm" style="margin-top:3px;margin-bottom:0px;margin-right:3px">
      <% page = 0 %>
      <% objects_per_page = 100 %>
      <% upto_file_number = objects.count %>
      <% if page > 0 %>
        <li><%= link_to '&laquo;'.html_safe, '#', data: { object: 'suppress-click' } %></li>
      <% else %>
        <li class="disabled"><span>&laquo;</span></li>
      <% end %>
      <li>
        <span>
          <b style="font-size:0.95em"><%= number_with_delimiter( page*objects_per_page + 1 ) %> to <%= number_with_delimiter [upto_file_number, objects.count].min %></b>
          of <%= number_with_delimiter objects.count %>
        </span>
      </li>
      <% if upto_file_number < objects.count %>
        <li><%= link_to '&raquo;'.html_safe, '#', data: { object: 'suppress-click' } %></li>
      <% else %>
        <li class="disabled"><span>&raquo;</span></li>
      <% end %>
    </ul>
  </div>
<% else %>
<div class="pull-right">
  <div class="alert alert-info"><%= pluralize @variables.size, 'search result' %></div>
  <table>
    <% @variables.group_by{|v| v.dataset}.sort.each do |dataset, dataset_variables| %>
      <tr>
        <td><span class="label" style="background-color:<%= dataset.color %>"><%= dataset.slug %></span></td>
        <td><%= link_to pluralize( dataset_variables.count, 'result' ), collection_path( s: params[:s], d: dataset.slug ) %></td>
      </tr>
    <% end %>
  </table>
  <%= link_to 'Show All Datasets', collection_path( s: params[:s] ), class: 'btn btn-xs btn-default' unless params[:d].blank? %>
  </ul>
</div>
<% end %>

<div class="row">
  <div class="col-xs-10" style="min-height:300px">
    <div class="row">
      <div class="col-xs-1">
      </div>
      <div class="col-xs-10">
        <div class="row">
          <% @variables.each do |variable| %>
            <div class="col-xs-12 col-sm-6 col-md-3">
              <%= render partial: 'welcome/variable_panel', locals: { variable: variable, collection: true } %>
            </div>
          <% end %>
        </div>
      </div>
      <div class="col-xs-1">

      </div>
    </div>
  </div>

  <div class="col-xs-2">
    <div id="variable_list">
      <%= render partial: 'datasets/variable_list' %>
    </div>
  </div>

</div>

<div class="modal" id="modal-container">
</div>
