- @title = 'Stats'
.slim-container.dark-texture
  %h1
    = @title
  = link_to 'Location', location_path, class: 'btn btn-xs btn-default'

.slim-container.math-texture
  %table.table.table-striped
    %thead
      %tr
        %th.center Regular member signups
        %th.center AUG member signups
        %th.center Core Team member signups
        %th.center Total Signups
    %tr
      %td.center= User.current.where( core_member: false, aug_member: false ).count
      %td.center= User.current.where( aug_member: true ).count
      %td.center= User.current.where( core_member: true ).count
      %td.center= User.current.count

  %table.table.table-striped
    %thead
      %tr
        %th.center Regular member signups
        %th.center= link_to 'Regular member DAUAs submitted', agreements_path( status: ['submitted', 'approved', 'resubmit', 'expired'], user_type: 'regular' )
        %th.center= link_to 'Regular member DAUAs approved', agreements_path( status: ['approved', 'expired'], user_type: 'regular' )
    %tr
      %td.center= User.current.where( core_member: false, aug_member: false ).count
      %td.center= Agreement.current.regular_members.where( status: ['submitted', 'approved', 'resubmit', 'expired'] ).count
      %td.center= Agreement.current.regular_members.where( status: ['approved', 'expired'] ).count

  %table.table.table-striped.fixed-font-size
    %col{ width: "1%" }
    %thead
      %tr
        %th
        %th.center{ colspan: "2" } Regular Members
        %th.center{ colspan: "2" } AUG + Core Members
        %th.center{ colspan: "2" } Total
      %tr
        %th Dataset
        %th.center{ colspan: "2" } Files Downloaded
        %th.center{ colspan: "2" } Files Downloaded
        %th.center{ colspan: "2" } Files Downloaded
    - Dataset.current.order(:release_date, :name).each do |dataset|
      %tr
        %td{ style: "white-space:nowrap" }= link_to dataset.name, audits_dataset_path(dataset)
        %td.center= pluralize number_with_delimiter(dataset.dataset_file_audits.regular_members.count), 'file'
        %td.center= number_to_human_size dataset.dataset_file_audits.regular_members.sum( :file_size )
        %td.center= pluralize number_with_delimiter(dataset.dataset_file_audits.aug_or_core_members.count), 'file'
        %td.center= number_to_human_size dataset.dataset_file_audits.aug_or_core_members.sum( :file_size )
        %td.center= pluralize number_with_delimiter(dataset.dataset_file_audits.count), 'file'
        %td.center= number_to_human_size dataset.dataset_file_audits.sum( :file_size )
    %tfoot
      %tr
        %th Total
        %th.center= pluralize number_with_delimiter(DatasetFileAudit.regular_members.count), 'file'
        %th.center.success= number_to_human_size DatasetFileAudit.regular_members.sum( :file_size )
        %th.center= pluralize number_with_delimiter(DatasetFileAudit.aug_or_core_members.count), 'file'
        %th.center= number_to_human_size DatasetFileAudit.aug_or_core_members.sum( :file_size )
        %th.center= pluralize number_with_delimiter(DatasetFileAudit.count), 'file'
        %th.center= number_to_human_size DatasetFileAudit.sum( :file_size )
