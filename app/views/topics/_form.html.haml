.content-container
  = form_for @topic, html: { class: 'form-vertical' } do |f|
    - if @topic.errors.any?
      .panel.panel-danger
        .panel-heading
          %strong
            = pluralize @topic.errors.count, 'error'
            prohibited this topic from being saved
        .panel-body
          %ul
            - @topic.errors.full_messages.each do |message|
              %li= message

    .form-group
      = f.label :title, class: 'control-label'
      = f.text_field :title, class: 'form-control', data: { object: (@topic.new_record? ? 'create-slug' : ''), target: '#topic_slug' }

    .form-group{ style: "#{'display:none' if @topic.new_record? && !@topic.errors.key?(:slug)}"}
      = f.label :slug, class: 'control-label'
      = f.text_field :slug, class: 'form-control'
      .alert.alert-info{ style: 'margin-top: 10px' }
        %p
          The URL slug must start with a lowercase letter
          = succeed ',' do
            %code a-z
          and only contain lowercase
          letters
          = succeed ',' do
            %code a-z
          numbers
          = succeed ',' do
            %code 0-9
          or dashes
          = succeed ',' do
            %code -
        %p
          %code.text-muted= "#{ENV['website_url']}/forum/#{@topic.slug}"

    - if @topic.new_record?
      .form-group
        = f.label :description, class: 'control-label'
        .preview-container
          .preview-header
            .pull-right
              = render 'replies/rich_text_editor_buttons', target: "#topic_description"
            = link_to 'Write', '#', data: { object: 'view-content-markdown' }, class: 'preview-tab active', tabindex: '-1'
            = link_to 'Preview', '#', data: { object: 'view-content-preview', content: '#topic_description' }, class: 'preview-tab', tabindex: '-1'
          .preview-body
            #content_markdown
              = f.text_area :description, rows: [[15, @topic.description.to_s.count("\n") + 1].max, 25].min, class: 'preview-control filedrag-container', data: { object: 'expandable-text-area dropfile-image', default_rows: 15, upload_url: upload_images_path(update: '#topic_description', format: 'js'), fallback_url: new_image_path, log_id: '#log_new' }
              #log_new.filedrag
                Drag images above to insert into post.
            #content_preview.topic{ style: 'display:none' }

    - if (current_user.aug_member? || current_user.core_member?) && Tag.forum_tags.count > 0
      .form-group
        = label :topic, :tag_ids, 'Tags', class: 'control-label'
        .row
          - if current_user.system_admin?
            .col-xs-6.col-sm-4.col-md-3.col-lg-2
              .checkbox
                %label
                  = f.check_box :pinned
                  Pinned
          = hidden_field_tag 'topic[tag_ids][]', nil
          - Tag.forum_tags.order(:name).each do |tag|
            .col-xs-6.col-sm-4.col-md-3.col-lg-2
              %label.checkbox.tag-checkbox{ class: "#{'tag-selected' if @topic.tags.include?(tag)}", style: "margin-bottom: 10px;background-color: #{tag.color}" }
                = check_box_tag "topic[tag_ids][]", tag.id, @topic.tags.include?(tag)
                .tag-name.nowrap{ style: 'overflow: hidden;' }
                  = tag.name

    .form-group
      = f.submit (@topic.new_record? ? 'Create Topic' : 'Update Topic'), class: 'btn btn-primary'
      = link_to 'Cancel', (@topic.new_record? ? topics_path : @topic), class: 'btn btn-default'

-# TODO: Remove unused code
- if false
  = form_for @topic, html: { class: 'form-horizontal' } do |f|
    - if @topic.errors.any?
      .callout.callout-danger
        %strong
          = pluralize @topic.errors.count, 'error'
          prohibited this topic from being saved

        %ul
          - @topic.errors.full_messages.each do |message|
            %li= message

    .form-group
      = f.label :title, nil, class: 'col-md-2 control-label'
      .col-md-10
        = f.text_field :title, class: 'form-control', maxlength: 40, autocomplete: 'off', data: { object: (@topic.new_record? ? 'create-slug' : ''), target: '#topic_slug' }
        .callout.callout-info
          The maximum length for the title is
          %strong 40 characters.
          - if @topic.new_record?
            Fill in additional details in the description.

    .form-group{ style: "#{'display:none' if @topic.new_record? && !@topic.errors.key?(:slug)}"}
      = f.label :slug, class: 'control-label'
      = f.text_field :slug, class: 'form-control'
      .alert.alert-info{ style: 'margin-top: 10px' }
        %p
          The URL slug must start with a lowercase letter
          = succeed ',' do
            %code a-z
          and only contain lowercase
          letters
          = succeed ',' do
            %code a-z
          numbers
          = succeed ',' do
            %code 0-9
          or dashes
          = succeed ',' do
            %code -
        %p
          %code.text-muted= "#{ENV['website_url']}/forum/#{@topic.slug}"


    - if @topic.new_record?
      .form-group
        = f.label :description, nil, class: 'col-md-2 control-label'
        .col-md-10
          = f.text_area :description, rows: 7, class: 'form-control', data: { object: 'text-area-autocomplete', mentions: User.current.pluck(:username).reject(&:blank?).uniq.sort }
    - else
      =# f.hidden_field :description, value: @topic.comments.first.description

    - if (current_user.aug_member? or current_user.core_member?) and Tag.forum_tags.count > 0
      .form-group
        = label :topic, :tag_ids, 'Tags', class: 'col-md-2 control-label'
        .col-md-10
          .row
            = hidden_field_tag 'topic[tag_ids][]', nil
            - Tag.forum_tags.order(:name).each do |tag|
              .col-xs-6.col-sm-4.col-md-3.col-lg-2
                %label.checkbox.tag-checkbox{ class: "#{'tag-selected' if @topic.tags.include?(tag)}", style: "margin-bottom: 10px;background-color: #{tag.color}" }
                  = check_box_tag "topic[tag_ids][]", tag.id, @topic.tags.include?(tag)
                  .tag-name.nowrap{ style: 'overflow: hidden;' }
                    = tag.name

    .form-group
      .col-md-offset-2.col-md-10
        = f.submit nil, class: 'btn btn-primary'
        = cancel
