- @title = @data_request.name

- content_for :header do
  .header-container
    .container
      %h1.page-heading
        .float-right
          = link_to transactions_review_path(@data_request), class: "btn btn-light btn-sm" do
            %i.fa.fa-th-list
            Transactions
          &nbsp;
          = link_to print_review_path(@data_request), class: "btn btn-light btn-sm", data: { turbolinks: false } do
            %i.fa.fa-print
            Print

        = @title
  .breadcrumb-container.mb-0
    .container
      .float-right.d-none.d-lg-block
        = render "reviews/tags", data_request: @data_request
      %ol
        %li
          = link_to reviews_path, class: "btn btn-sm btn-light" do
            %i.fa.fa-caret-left
            Reviews
        %span#agreement-reviewers= render "reviews/reviewers", data_request: @data_request

.card.mb-5
  %h4.card-header
    .float-right
      = @data_request.final_legal_document.version
      %span.small.d-none.d-md-inline>= ".#{@data_request.final_legal_document.md5_short}"
    = @data_request.final_legal_document.name
  .card-body
    - @data_request.final_legal_document.final_legal_document_variables.each do |variable|
      - agreement_variable = @data_request.agreement_variables.find_by(final_legal_document_variable_id: variable.id)
      - value = (agreement_variable ? agreement_variable.value : "")

      - if variable.variable_type == "checkbox"
        - content = simple_check(value == "1")
      - else
        - content = (agreement_variable ? agreement_variable.value : "")
      - display_name = variable.display_name.present? ? variable.display_name : variable.name.titleize
      - if variable.required? && content.blank?
        - display_name = "<div class=\"text-danger\">#{display_name}</div>".html_safe
        - if variable.variable_type == "checkbox"
          - content = "<div class=\"text-danger\">#{content}</div>".html_safe
        - else
          - content = "<span class=\"legal-document-variable-missing-content\">&nbsp;</span>".html_safe
      = render "forms/horizontal/show/generic", title: display_name, content: content

    - if @data_request.final_legal_document.attestation_type == "signature"
      - if @data_request.signature_file.path
        - content = image_tag(signature_review_path(@data_request), class: "img-signature", alt: "")
      - else
        - content = "<div class=\"text-muted\">No signature</div>".html_safe
      = render "forms/horizontal/show/generic", title: "Signature", content: content

#agreement_events
  = render "agreement_events/index"

#agreement_events_new_form
  - @agreement_event = @data_request.agreement_events.where(user_id: current_user.id).new
  = render "agreement_events/form"

- other_data_requests = @data_request.user.data_requests.where.not(id: @data_request.id).where(status: %w(submitted resubmit approved expired))
- if other_data_requests.count > 0
  .comment_outer.mb-5
    .comment-right-fluid
      .p-3.mb-2.bg-primary.text-white.lead.text-center
        = @data_request.user.first_name
        has
        = other_data_requests.count
        other
        = succeed "." do
          = "data request#{"s" if other_data_requests.count > 1}"

      .card-deck
        - other_data_requests.each do |dr|
          .card.mb-3{ style: "min-width: 18rem;" }
            .card-header.bg-dark.text-white
              .float-right
                = status_helper(dr)
              = link_to "##{dr.id}", review_path(dr), class: "link-inherit"
            .card-footer
              = name_of_datasets(dr)

.card
  %h4.card-header
    .float-right
      = @data_request.final_legal_document.version
      %span.small.d-none.d-md-inline>= ".#{@data_request.final_legal_document.md5_short}"
    = @data_request.final_legal_document.name
  .card-body
    - @data_request.final_legal_document.final_legal_document_pages.each do |page|
      = legal_markdown page, reviewer: true
