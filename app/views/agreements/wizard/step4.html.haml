.slim-container
  = render 'agreements/wizard/daua_progress'

  %h2.center SIGNATURE

  %hr.divider-md

  = form_for @agreement, url: update_step_agreement_path(@agreement), method: :patch, html: { class: 'form-vertical', id: 'update_step_form', data: { object: 'signature', signature_target: '.output-write' } } do |f|
    - if @agreement.errors.any?
      #error_explanation.bs-callout.bs-callout-danger
        %h4
          = pluralize(@agreement.errors.count, "error")
          prohibited this step from being saved

        %ul
          - @agreement.errors.full_messages.each do |msg|
            %li= msg

    = hidden_field_tag "agreement[draft_mode]", nil
    = hidden_field_tag "step", @step
    = hidden_field_tag "agreement[current_step]", @step

    .row
      .col-sm-6
        .panel.panel-info.panel-hover{ data: { object: "select_radio_button", target: "#agreement_unauthorized_to_sign_false" } }
          .panel-heading
            Option 1 - Data User Signature
          .panel-body
            .form-group
              .radio
                %label
                  = f.radio_button :unauthorized_to_sign, false
                  I am authorized to sign this Data Access and Use Agreement


            .form-group
              = f.label :signature, nil, class: 'control-label'
              %div{ style: "position:relative" }
                = f.hidden_field :signature, class: 'output-write'
                %canvas.pad{ width: "300", height: "55" }
                %span.clearButton{ style: "position: absolute; margin-top: 12.5px; margin-left: 10px;" }
                  = link_to 'Clear', '#clear', class: 'btn btn-default', tabindex: '-1'
                %p.lead
                  Signature of Data User

            .form-group
              = f.label :signature_print, 'By (print name)', class: 'control-label'
              = f.text_field :signature_print, class: 'form-control'

            .form-group
              = f.label :signature_date, 'Date Signed', class: 'control-label'
              = f.text_field :signature_date, class: 'datepicker form-control', value: @agreement.signature_date ? @agreement.signature_date.strftime('%m/%d/%Y') : ''

      .col-sm-6
        .panel.panel-info.panel-hover{ data: { object: "select_radio_button", target: "#agreement_unauthorized_to_sign_true" } }
          .panel-heading
            Option 2 - Duly Authorized Representative Signature
          .panel-body
            - signature_request_url = "#{ENV['website_url']}/agreements/#{@agreement.to_param}/#{@agreement.duly_authorized_representative_token}/signature-requested"
            .form-group
              .radio
                %label
                  = f.radio_button :unauthorized_to_sign, true
                  Signature will be provided by Data User's Duly Authorized
                  Representative
              - unless @agreement.duly_authorized_representative_valid?
                .bs-callout.bs-callout-info
                  %strong Important
                  %br
                  If you are not authorized to sign an agreement based on institutional
                  requirements:
                  %ol
                    %li Check the above box
                    %li Type authorized user's name below
                    %li Email the link below to your authorized user
                    %li
                      Click
                      %strong Save Draft

                  You will receive an email notification when your authorized user
                  has signed the DAUA.

            - unless @agreement.duly_authorized_representative_valid?
              .form-group
                = f.label :duly_authorized_representative_signature_print, 'Duly Authorized Representative Name', class: 'control-label'
                = f.text_field :duly_authorized_representative_signature_print, class: 'form-control'

              %p
                %strong Email the following link
                to your Duly Authorized Representative.
              = link_to signature_request_url, signature_request_url, target: '_blank'

            - if @agreement.duly_authorized_representative_valid?
              .bs-callout.bs-callout-info
                %strong All Set!
                %br
                Your Duly Authorized
                Represenative has signed your DAUA. Click
                %strong.text-success Save and Continue
                below to finalize your data access and use agreement.

              .form-group
                = f.label :duly_authorized_representative_signature, nil, class: 'control-label'
                %div{ data: { object: "signature-display", signature_target: ".output-read" } }
                  = hidden_field_tag 'duly_authorized_representative_signature', @agreement.duly_authorized_representative_signature, class: 'output-read'
                  %canvas.pad-display{ width: "300", height: "55" }
                  %p.lead
                    Signature of Duly Authorized Representative

              .form-group
                = f.label :duly_authorized_representative_signature_print, 'Duly Authorized Representative (print name)', class: 'control-label'
                .form-control{ disabled: '' }= @agreement.duly_authorized_representative_signature_print

              .form-group
                = f.label :duly_authorized_representative_signature_date, 'Date Signed', class: 'control-label'
                .form-control{ disabled: '' }= @agreement.duly_authorized_representative_signature_date ? @agreement.duly_authorized_representative_signature_date.strftime('%m/%d/%Y') : ''

    %hr.divider-md

    .row
      .col-xs-4
        = link_to step_agreement_path(@agreement, step: @step-1), class: 'btn btn-lg btn-default btn-block' do
          %span.glyphicon.glyphicon-arrow-left
          Back to Previous Step
      .col-xs-4
        = link_to '#', data: { object: 'submit-draft', target: '#update_step_form' }, class: 'btn btn-lg btn-warning btn-block' do
          %span.glyphicon.glyphicon-floppy-disk
          Save Draft
      .col-xs-4
        = link_to '#', data: { object: 'submit', target: '#update_step_form' }, class: 'btn btn-lg btn-primary btn-block' do
          %span.glyphicon.glyphicon-floppy-disk
          Save and Continue

  - @footer_img = 'footer.jpg'
