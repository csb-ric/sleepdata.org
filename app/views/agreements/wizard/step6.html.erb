<%= render partial: 'agreements/wizard/daua_progress' %>

<h2 style="text-align:center">SIGNATURE</h2>

<hr class="divider-md" />

<%= form_for @agreement, url: update_step_agreement_path(@agreement), method: :patch, html: { class: 'form-horizontal', id: 'update_step_form', data: { object: 'signature', signature_target: '.output-write' } } do |f| %>
  <% if @agreement.errors.any? %>
    <div id="error_explanation" class="bs-callout bs-callout-danger">
      <h4><%= pluralize(@agreement.errors.count, "error") %> prohibited this step from being saved</h4>

      <ul>
      <% @agreement.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <%= hidden_field_tag "agreement[draft_mode]", nil %>
  <%= hidden_field_tag "step", @step %>
  <%= hidden_field_tag "agreement[current_step]", @step %>

  <div class="form-group">
    <%= f.label :signature, nil, class: 'col-md-3 control-label' %>
    <div class="col-md-9" style="position:relative">
      <%= f.hidden_field :signature, class: 'output-write' %>
      <canvas class="pad" width="300" height="55"></canvas>
      <span class="clearButton" style="position: absolute; margin-top: 12.5px; margin-left: 10px;"><%= link_to 'Clear', '#clear', class: 'btn btn-default', tabindex: '-1' %></span>
      <p class="lead">Signature of Data User (or Data User's Duly Authorized Representative, if an organization)</p>
    </div>
  </div>

  <div class="form-group">
    <div class="col-md-9 col-md-offset-3">
      <div class="checkbox">
        <label>
          <%= f.check_box :unauthorized_to_sign %>
          I am unauthorized to sign an agreement based on institutional requirements.
        </label>
      </div>
      <div class="bs-callout bs-callout-info">
        <strong>Heads Up</strong>
        If you are not authorized to sign an agreement based on institutional requirements, check the above box, and type the institutions authorized user's name below.
      </div>
    </div>
  </div>




  <div class="form-group">
    <%= f.label :signature_print, 'By (print name)', class: 'col-md-3 control-label' %>
    <div class="col-md-9">
      <%= f.text_field :signature_print, class: 'form-control' %>
    </div>
  </div>

  <div class="form-group">
    <%= f.label :signature_date, 'Date Signed', class: 'col-md-3 control-label' %>
    <div class="col-md-9">
      <%= f.text_field :signature_date, class: 'datepicker form-control', value: @agreement.signature_date ? @agreement.signature_date.strftime('%m/%d/%Y') : '' %>
    </div>
  </div>

  <% if @agreement.data_user_type == 'organization' %>
    <div class="form-group">
      <%= f.label :organization_emails, 'Approved Organization Member Emails', class: 'col-md-3 control-label' %>
      <div class="col-md-9">
        <%= f.text_area :organization_emails, class: 'form-control', rows: '5' %>
        <div class="bs-callout bs-callout-danger">
          <h4>Attention</h4>
          <p>If you are the <strong>Duly Authorized Representative</strong>, you must provide a list of email addresses for members of your organization who will be covered by this agreement. Once approved, users who have registered with one of the email addresses provided on this list will be granted access to download files for the selected datasets.</p>
          <p><strong>Users may not be added to this list after the submission is approved.</strong></p>
        </div>
      </div>
    </div>
  <% end %>

  <hr class="divider-md" />

  <div class="row">
    <div class="col-xs-4">
      <%= link_to "<span class='glyphicon glyphicon-arrow-left'></span> Back to Previous Step".html_safe, step_agreement_path(@agreement, step: @step-1), class: 'btn btn-lg btn-default btn-block' %>
    </div>
    <div class="col-xs-4">
      <%= link_to "<span class='glyphicon glyphicon-floppy-disk'></span> Save Draft".html_safe, '#', data: { object: 'submit-draft', target: '#update_step_form' }, class: 'btn btn-lg btn-warning btn-block' %>
    </div>
    <div class="col-xs-4">
      <%= link_to "<span class='glyphicon glyphicon-floppy-disk'></span> Save and Continue".html_safe, '#', data: { object: 'submit', target: '#update_step_form' }, class: 'btn btn-lg btn-primary btn-block' %>
    </div>
  </div>
<% end %>

<% @footer_img = 'footer.jpg' %>
