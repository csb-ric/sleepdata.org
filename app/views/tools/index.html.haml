- @title = "Tools"

= render "layouts/service_announcement"

- content_for :header_simple do
  .float-right
    =# link_to plus_or("Contribute a tool"), contribute_tool_start_path, class: "btn btn-primary btn-shadow"
    = render "layouts/per_page", per_page: 20, object_count: @tools.total_count
  = @title

- if @tools.present?
  .topics
    %table.table.table-striped.table-borderless.table-hover.table-sticky
      - if false
        %col{ width: "1px" }
      %col{ width: "75%" }
      %col.d-none.d-sm-table-column{ width: "25%" }
      %col{ width: "1px" }
      %col.d-none.d-md-table-column
      - if current_user && current_user.admin?
        %col{ width: "1px" }
      %thead
        %tr
          - if false
            = th_sort_field_rev @order, "tools.rating", "Rating", extra_class: "text-center"
          %th.p-2
            = form_with url: tools_path, method: :get, local: true, skip_enforcing_utf8: true do |form|
              = form.text_field :search, value: params[:search], placeholder: "Search tools", autocomplete: "off", class: "table-cell-search-input border rounded"
          - if false
            %th{ class: params[:order] == "tools.name desc" || params[:order].blank? ? "sort-selected" : nil }
              - case params[:order]
              - when "tools.name desc"
                = link_to "Name", tools_path
              - else
                = link_to "Name", tools_path(order: "tools.name desc")
          %th.d-none.d-sm-block
            Author
          %th.nowrap
            Type
            .dropdown{ style: "display: inline-block" }
              = link_to "#", data: { target: "#", toggle: "dropdown" }, role: "button", aria: { haspopup: "true", expanded: "false" } do
                %i.fa.fa-filter
              .dropdown-menu.dropdown-menu-right
                = link_to "All", tools_path(order: params[:order]), style: params[:type].blank? ? "font-weight:bold;" : "", class: "dropdown-item"
                - [["Program", "program"], ["Script", "script"], ["Tutorial", "tutorial"]].each do |label, value|
                  = link_to label, tools_path(order: params[:order], type: value), style: params[:type] == value ? "font-weight:bold;" : "", class: "dropdown-item"
          = th_sort_field_rev @order, "tools.publish_date", "Published", extra_class: "d-none d-md-block text-center"
          - if current_user && current_user.admin?
            %th.text-center
              .d-none.d-sm-inline-block Actions

      %tbody
        - @tools.each do |tool|
          %tr
            - if false
              %td.text-center
                = link_to tool_tool_reviews_path(tool) do
                  = render "tools/rating", rating: tool.rating
            %td= link_to tool.name, tool_path(tool)
            %td.d-none.d-sm-block
              %small= link_to tool.user.username, member_path(tool.user.username), class: "link-blend-semi-muted"
            %td.text-center
              - if tool.tag_program?
                %small Program
              - if tool.tag_script?
                %small Script
              - if tool.tag_tutorial?
                %small Tutorial
              - unless tool.tag_program? || tool.tag_script? || tool.tag_tutorial?
                / %span.badge.badge-pill.badge-default Unsorted
            %td.d-none.d-md-block.nowrap.text-center
              - if tool.published?
                = tool.publish_date
              - else
                %span.badge.badge-warning DRAFT
            - if current_user && current_user.admin?
              %td
                = render "layouts/edit_delete_dropdown", edit_url: edit_admin_tool_path(tool), delete_url: admin_tool_path(tool), delete_confirmation: "Delete #{tool.name}?"

  .center-horizontally= paginate @tools, theme: "bootstrap"
- else
  .jumbotron.text-center
    %p.lead
      We didn't find any tools matching your search criteria.
      = succeed "." do
        = link_to "Back to tools", tools_path
    %p.lead
      Feel like helping us out?
      = succeed "." do
        = link_to "Contribute a tool", contribute_tool_start_path
