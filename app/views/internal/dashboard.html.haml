- content_for :body_class do
  brand-background

.row
  .col-sm-3.col-md-3
    = render "internal/profile"

  .col-sm-9.col-md-6
    - if current_user.agreements.present?
      .dashboard-container
        .dashboard-title
          %strong My Submissions
          %small= link_to "view all", submissions_path

        %table.table.table-striped.table-borderless.table-hover
          %col{ width: "1px" }
          %col
          %col
          %thead
            %tr
              %th Status
              %th
                Name
              %th.center
                Datasets
          - current_user.agreements.order(id: :desc).each do |agreement|
            %tr
              %td
                - if agreement.under_review?
                  %span.label.label-warning under review
                - elsif agreement.approved?
                  %span.label.label-success approved
                - elsif agreement.status == "expired"
                  %span.label.label-default expired
                - elsif agreement.status == "closed"
                  %span.label.label-danger closed
                - else
                  %span.label.label-info started

              %td.nowrap
                = link_to submissions_path do
                  Agreement
                  = "##{agreement.agreement_number}"
              %td
                - agreement.datasets.order(:release_date).each do |dataset|
                  %code= dataset.slug
    - else
      .dashboard-container
        .dashboard-title
          %strong Data Access Requests
        %p
          Access data by requesting access to one or more
          = succeed "." do
            = link_to "datasets", datasets_path
        %p
          If you need any help, you may send us an email at
          = succeed "." do
            = mail_to "support@sleepdata.org"

    .dashboard-container
      .dashboard-title
        %strong Tool Contributions
      - if current_user.community_tools.present?
        %table.table.table-striped.table-borderless.table-hover
          %thead
            %tr
              %th
                Name
              %th.center
                Actions
          - current_user.community_tools.order(:name).each do |community_tool|
            %tr
              %td{ style: "overflow:hidden;text-overflow: ellipsis;"}
                - if community_tool.draft?
                  - name = (community_tool.name.present? ? community_tool.name : community_tool.url)
                  = name
                - else
                  = link_to community_tool.name, community_show_tool_path(community_tool)
              %td
                - if community_tool.draft?
                  = link_to "Continue Draft", contribute_tool_description_path(community_tool), class: "btn btn-sm btn-accent btn-block"
                - else
                  = link_to "Edit", contribute_tool_description_path(community_tool), class: "btn btn-sm btn-light btn-block"
      - else
        %p Do you have a tool you would like to share with the NSRR research community?

      = link_to "Contribute a Tool", contribute_tool_start_path, class: "btn btn-sm btn-accent btn-block btn-shadow"


    .dashboard-container
      .center
        Email us at
        = mail_to "support@sleepdata.org"
        with any questions!

  .hidden-xs.hidden-sm.col-md-3
    = render "internal/sidebar/blog_posts"
